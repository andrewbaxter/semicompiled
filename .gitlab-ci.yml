---
image: debian:11
cache:
  key: apt
  paths:
    - apt-cache/
cache:
  key: custom
  paths:
    - semicache/
pages:
  stage: deploy
  script:
    - export APT_CACHE_DIR=`pwd`/apt-cache
    - mkdir -pv $APT_CACHE_DIR
    - apt-get update && apt-get install -y openjdk-11-jdk maven clang clang-format wabt emscripten
    - export SEMICACHE_DIR=`pwd`/semicache
    - mkdir -pv $SEMICACHE_DIR
    - mvn -Dmaven.repo.local=$SEMICACHE_DIR compile exec:java
  artifacts:
    paths:
      - public
  only:
    - master